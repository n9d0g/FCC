if (self.CavalryLogger) { CavalryLogger.start_js(["ikXx9"]); }

__d("FBRTCIncomingCallController",["fbt","Cache","DocumentTitle","FBRTCCallBlockingStore","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCCallUIWrapper","FBRTCConstants","FBRTCLocalMessageQueue","FBRTCLocalUploadLogLevel","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageSender","FBRTCSupport","MercuryIDs","MessengerBrowserAlerts","MessengerParticipants.bs","RTWebExperiments","UserActivity"],(function(a,b,c,d,e,f,g){var h=30;a=function(){"use strict";function a(a,c,d){this.$12=null,this.$1=null,this.$2=a,this.$3=c,this.$4=d,this.$5=null,this.$6=null,this.$7=new(b("FBRTCMessageSender"))(),this.$8=b("FBRTCCallSummaryStore").getInstance(),this.$9=b("FBRTCLogger").getInstance(),this.$10=null,this.$11=new(b("Cache"))()}var c=a.prototype;c.setCustomAnswerHandler=function(a){this.$12=a};c.onMessageReceived=function(a){var c;try{c=new(b("FBRTCMessage"))(a)}catch(b){this.$9.logErrorWithoutID("Unknown data: "+JSON.stringify(a));return}if(!b("FBRTCMessageDedup").check(c.peerID,c.callID,c.msgID)){c.isOffer()&&this.$13()&&this.$7.sendOfferAck(c.peerID,c.callID,c.msg);this.$9.logInfo(c.peerID,c.callID,"Ignoring message (duplicate): "+c.msgID);return}this.$9.logReceivedMessage(c.peerID,c.callID,c.msg);!b("RTWebExperiments").enableCallCollisionFix()&&b("FBRTCSupport").isWebrtcSupported()&&c.msgType!==b("FBRTCConstants").PayloadType.OFFER&&b("FBRTCLocalMessageQueue").enqueueMessage(c.peerID,c.msgID,a);switch(c.msgType){case b("FBRTCConstants").PayloadType.OFFER:this.$14(c);break;case b("FBRTCConstants").PayloadType.HANGUP:this.$15(c);break;case b("FBRTCConstants").PayloadType.OTHER_DISMISS:this.$16(c);break;case b("FBRTCConstants").PayloadType.ICE_CANDIDATE:case b("FBRTCConstants").PayloadType.OFFER_ACK:case b("FBRTCConstants").PayloadType.ANSWER:case b("FBRTCConstants").PayloadType.MSG_ACK:case b("FBRTCConstants").PayloadType.OK:case b("FBRTCConstants").PayloadType.PING:case b("FBRTCConstants").PayloadType.PRANSWER:case b("FBRTCConstants").PayloadType.ICERESTART_OFFER:case b("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case b("FBRTCConstants").PayloadType.PCRESTART_ANSWER:case b("FBRTCConstants").PayloadType.PCRESTART_OFFER:case b("FBRTCConstants").PayloadType.SDP_UPDATE:case b("FBRTCConstants").PayloadType.ANSWER_ACK:case b("FBRTCConstants").PayloadType.SET_VIDEO:case b("FBRTCConstants").PayloadType.OFFER_NACK:case b("FBRTCConstants").PayloadType.VIDEO_REQUEST:case b("FBRTCConstants").PayloadType.ACK:break;default:break}};c.$14=function(a){var c=this,d=a.callID,e=a.msg,f=a.peerID;if(this.$17(d))return;if(e.calltype){this.$7.sendOfferNack(f,d,e);return}this.$13()?this.$7.sendOfferAck(f,d,e):this.$7.sendOfferNack(f,d,e);this.$9.logCallAction(f,d,b("FBRTCLogger").CallAction.RECEIVED_CALL);var g=this.$18(f,d,a);g.setUploadLogLevel(b("FBRTCLocalUploadLogLevel").getUploadLogLevel(b("FBRTCConstants").convertToUploadLogLevel(e.ull)));if(b("FBRTCCallBlockingStore").getBlockingStatus()){this.$19(f,d,g,b("FBRTCConstants").CallEndReason.IGNORE_CALL,!1,!1,!1,"calling disabled");return}var h=this.$2.getCallEndReasonForNewRequest();if(this.$5&&!this.$5.isForPeer(f)||h===b("FBRTCConstants").CallEndReason.IN_ANOTHER_CALL){this.$19(f,d,g,b("FBRTCConstants").CallEndReason.IN_ANOTHER_CALL,!1,!1,!0);this.$4.onCallMissed(f);return}if(!b("FBRTCSupport").isWebrtcSupported()){this.$19(f,d,g,b("FBRTCConstants").CallEndReason.UNSUPPORTED_VERSION,!1,!1,!1);this.$3.showForIncomingCall(d,f);this.$20();return}h=new this.$2(f,d);this.$6=g;h.addListener("answerCall",function(b,e){c.$20(),c.$21(f,d,a,g,e)});h.addListener("ignoreCall",function(){c.$20(),c.$22(f,d,g)});h.addListener("timeout",function(){c.$20(),c.$23(f,d,g)});this.$4.hideDialog();e=e.videoon?b("FBRTCConstants").IncomingCallDialogTypes.VIDEO:b("FBRTCConstants").IncomingCallDialogTypes.AUDIO;h.showIncomingDialog(e);this.$5=h;this.$9.logEvent(f,d,"Incoming call dialog shown");this.$24(f);this.$25(a,g)};c.$24=function(a){document.hasFocus()||this.$26(a)};c.$27=function(){this.$28()};c.$26=function(a){var c=this;a=b("MercuryIDs").getParticipantIDFromUserID(a);b("MessengerParticipants.bs").get(a,function(a){if(!c.$5)return;c.$10=b("DocumentTitle").blink(g._("Tumatawag si {name}",[g._param("name",a.short_name)]))});b("UserActivity").subscribeOnce(this.$28.bind(this))};c.$25=function(a,c){var d=this,e=a.callID,f=a.msg,g=a.peerID,h=f.videoon;f={callID:e,peerID:g,onNotificationClicked:function(){d.$5!=null&&d.$5.cancel(),d.$21(g,e,a,c,h)},isVideoCall:h,isGroupCall:!1};b("MessengerBrowserAlerts").showRTCNotification(f,function(a){d.$1=a})};c.$20=function(){this.$1&&(this.$1.close(),this.$1=null)};c.$28=function(){this.$10&&(this.$10.stop(),this.$10=null)};c.$29=function(){this.$5&&this.$5.cancel(),this.$5=null,this.$6=null,this.$27()};c.$15=function(a){var c=a.peerID,d=a.callID;a=a.msg;this.$30(d);if(this.$5&&this.$5.isForPeerAndCall(c,d)){a=a.reason;(typeof a==="string"||a instanceof String)&&(a=b("FBRTCConstants").endCallReasonFromString(a));this.$19(c,d,this.$6,a,!0,!0,!1);this.$29();a!==b("FBRTCConstants").CallEndReason.OTHER_INSTANCE_HANDLED&&(this.$4.onCallMissed(c),this.$4.showDialog())}};c.$13=function(){return b("FBRTCSupport").isWebrtcSupported()};c.$16=function(a){a=a.callID;this.$30(a);b("FBRTCSupport").isWebrtcSupported()||this.$3.dismiss();this.$5&&this.$5.isForCall(a)&&this.$29()};c.$30=function(a){this.$11.set(a,!0,null,h)};c.$17=function(a){return this.$11.has(a)};c.$18=function(a,c,d){a=new(b("FBRTCCallSummary"))({peerID:a,callID:c,isCaller:!1});a.setCallTrigger("incoming_p2p_ring_dialog");a.setActiveConnection("p2p");a.onFullMessageReceived(d);a.onOfferAckSent(d.msg);return a};c.$21=function(a,c,d,e,f){var g=!d.msg.videoon;e.onPressedAnswer();e.save(this.$8);this.$9.logCallAction(a,c,b("FBRTCLogger").CallAction.ANSWER_CALL);this.$7.sendOtherDismiss(c);!b("RTWebExperiments").passOfferWithWindowMessages()?b("FBRTCLocalMessageQueue").writePeerOfferToStorage(a,d.originalMessageData):b("RTWebExperiments").enableCallCollisionFix()||b("FBRTCLocalMessageQueue").enqueueMessage(a,d.msgID,d.originalMessageData);d=this.$12;d?d({peerID:a,callID:String(c),callSummary:e,initializeVideo:f,isAudioCall:g}):b("FBRTCCallUIWrapper").openAsCallee(a,c,e,g,f);this.$29()};c.$22=function(a,c,d){this.$19(a,c,d,b("FBRTCConstants").CallEndReason.IGNORE_CALL,!1,!0,!0),this.$29()};c.$23=function(a,c,d){this.$19(a,c,d,b("FBRTCConstants").CallEndReason.NO_ANSWER_TIMEOUT,!1,!1,!1),this.$29(),this.$4.onCallMissed(a),this.$4.showDialog()};c.$19=function(a,c,d,e,f,g,h,i){i===void 0&&(i=null);h&&this.$7.sendHangup(a,c,e);g&&this.$7.sendOtherDismiss(c);d&&(d.onCallEnded(e,f,null,i),d.save(this.$8));h=b("FBRTCConstants").fullCallEndReasonString(e,f);this.$9.logCallAction(a,c,b("FBRTCLogger").CallAction.END_CALL,h)};return a}();e.exports=a}),null);
__d("FBRTCSoundController",["RTCConfig","RTWebUserActionLogger","Sound"],(function(a,b,c,d,e,f){var g=[(a=b("RTCConfig")).ringtone_mp3_url,a.ringtone_ogg_url],h=[a.ringback_mp3_url,a.ringback_ogg_url];c={playIncomingRingtone:function(a,c,d){var e=d.loop,f=d.isP2P;d=d.isUnsupportedDialog;d=d===void 0?!1:d;c=["incoming_ringtone",a.toString(),c].join("_");b("Sound").play(g,c,e);b("RTWebUserActionLogger").logEvent({callID:a.toString(),callType:f?"p2p":"mw",component:"incoming_ring_tone",eventName:"ring_tone_played",surface:d?"missed_call_dialog":"incoming_call_dialog"})},stopIncomingRingtone:function(){b("Sound").stop(g)},playRingbackTone:function(){b("Sound").play(h,null,!0)},stopRingbackTone:function(){b("Sound").stop(h)}};e.exports=c}),null);
__d("XIncomingCallDialogController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/incoming/",{user_id:{type:"FBID",required:!0},call_id:{type:"Int"},dialog_type:{type:"String",defaultValue:"VIDEO"},__asyncDialog:{type:"Int"}})}),null);
__d("FBRTCIncomingCallDialog",["AsyncDialog","AsyncRequest","Dialog","EventEmitter","FBRTCConstants","FBRTCSoundController","XIncomingCallDialogController","clearTimeout","setTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){var g=7e4;a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b,c){var d;d=a.call(this)||this;d.peerID=b;d.callID=c;d.$FBRTCIncomingCallDialog2=!1;d.$FBRTCIncomingCallDialog1=null;return d}c.getCallEndReasonForNewRequest=function(){return null};var d=c.prototype;d.showIncomingDialog=function(a){var c=b("Dialog").getCurrent();c&&c.hide();c=b("XIncomingCallDialogController").getURIBuilder().setFBID("user_id",this.peerID).setInt("call_id",this.callID).setString("dialog_type",a).getURI();this.$FBRTCIncomingCallDialog1=new(b("AsyncRequest"))(c);this.$FBRTCIncomingCallDialog2=a===b("FBRTCConstants").IncomingCallDialogTypes.VIDEO;b("AsyncDialog").send(this.$FBRTCIncomingCallDialog1,this.$FBRTCIncomingCallDialog3.bind(this))};d.$FBRTCIncomingCallDialog3=function(a){if(!this.$FBRTCIncomingCallDialog1){b("setTimeout")(function(){a.hide()},1);return}this.$FBRTCIncomingCallDialog1=null;this.view=a;a.subscribe("confirm",this.$FBRTCIncomingCallDialog4.bind(this));a.subscribe("cancel",this.$FBRTCIncomingCallDialog5.bind(this));b("FBRTCSoundController").playIncomingRingtone(this.callID,this.peerID,{loop:!0,isP2P:!0});this.timeout=b("setTimeoutAcrossTransitions")(this.$FBRTCIncomingCallDialog6.bind(this),g)};d.cancel=function(){this.$FBRTCIncomingCallDialog1&&(this.$FBRTCIncomingCallDialog1.abort(),this.$FBRTCIncomingCallDialog1=null),this.timeout&&b("clearTimeout")(this.timeout),this.view&&(this.view.hide(),this.view=null),b("FBRTCSoundController").stopIncomingRingtone()};d.isForPeer=function(a){return this.peerID===a};d.isForCall=function(a){return this.callID===a};d.isForPeerAndCall=function(a,b){return this.peerID===a&&this.callID===b};d.$FBRTCIncomingCallDialog4=function(){this.cancel(),this.emit("answerCall",this.callID,this.$FBRTCIncomingCallDialog2)};d.$FBRTCIncomingCallDialog5=function(){this.cancel(),this.emit("ignoreCall",!1)};d.$FBRTCIncomingCallDialog6=function(){this.cancel(),this.emit("timeout",!1)};return c}(b("EventEmitter"));e.exports=a}),null);
__d("XVideoCallMissedCallController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/missed_call/",{user_id:{type:"Int",required:!0},__asyncDialog:{type:"Int"}})}),null);
__d("XVideoCallMissedCallDialogController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/dismiss_all_missed_call_dialog/",{})}),null);
__d("FBRTCMissedVideoCallHandler",["Arbiter","AsyncDialog","AsyncRequest","ChannelConstants","FBRTCCore","FBRTCLogger","FBRTCSupport","XVideoCallMissedCallController","XVideoCallMissedCallDialogController","qex"],(function(a,b,c,d,e,f){var g=null,h=null,i=null;a=function(){"use strict";function a(){this.$1=null}var c=a.prototype;c.hideDialog=function(){g&&(g.hide(),g=null,h=null,i&&(i.unsubscribe(),i=null))};c.onCallMissed=function(a){if(!b("FBRTCSupport").isWebrtcSupported())return;h===null&&(this.$1=a)};c.showDialog=function(a){a&&(this.$2=a);if(!this.$1||h)return;h=this.$1;this.$1=null;a=b("XVideoCallMissedCallController").getURIBuilder().setInt("user_id",h).getURI();a=new(b("AsyncRequest"))(a);b("AsyncDialog").send(a,this.$3.bind(this))};c.$3=function(a){g=a,a.subscribe("confirm",this.$4.bind(this)),a.subscribe("cancel",this.$5.bind(this)),i=b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("dismiss_all_missed_call_dialog"),this.$6.bind(this))};c.$4=function(){h&&(b("qex")._("1277463")?this.$2!=null&&this.$2():b("FBRTCCore").startOutgoingCall(h,b("FBRTCLogger").Trigger.RETURN_CALL,!1)),this.$5()};c.$5=function(){this.hideDialog(),this.$7()};c.$7=function(){new(b("AsyncRequest"))(b("XVideoCallMissedCallDialogController").getURIBuilder().getURI()).send()};c.$6=function(){this.hideDialog()};return a}();e.exports=a}),null);
__d("XBrowserNotSupportedDialogController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/browser_not_supported/",{is_group_call:{type:"Bool",defaultValue:!1},participants:{type:"StringVector"},user_id:{type:"Int"},warning:{type:"Bool",defaultValue:!1},call_type:{type:"Enum",defaultValue:2,enumType:0},__asyncDialog:{type:"Int"}})}),null);
__d("FBRTCUnsupportedBrowserMessage",["AsyncDialog","AsyncRequest","FBRTCCallConstants","FBRTCSoundController","MessengerDialogs.re","MessengerRTCUnsupportedBrowserUpsellDialog.react","React","XBrowserNotSupportedDialogController","ZenonUpsellLinks"],(function(a,b,c,d,e,f){var g=b("FBRTCCallConstants").FBRTCCallType,h=b("React");a={_dialog:null,warnForOutgoingCall:function(a){var c=b("XBrowserNotSupportedDialogController").getURIBuilder().setBool("warning",!0).getURI();this._presentDialog(c,a)},showForOutgoingCall:function(){var a=b("ZenonUpsellLinks").getDesktopUpsellLinkIfEnabledForCalls();if(a!=null)b("MessengerDialogs.re").showDialog(function(){return h.jsx(b("MessengerRTCUnsupportedBrowserUpsellDialog.react"),{desktopAppstoreLink:a,hideDialog:b("MessengerDialogs.re").removeAllDialogs,onUnmount:function(a){a||b("MessengerDialogs.re").removeAllDialogs()}})});else{var c=b("XBrowserNotSupportedDialogController").getURIBuilder().getURI();this._presentDialog(c)}},showForIncomingCall:function(a,c){b("FBRTCSoundController").playIncomingRingtone(a,c,{loop:!1,isP2P:!0,isUnsupportedDialog:!0});var d=b("ZenonUpsellLinks").getDesktopUpsellLinkIfEnabledForCalls();if(d!=null)b("MessengerDialogs.re").showDialog(function(){return h.jsx(b("MessengerRTCUnsupportedBrowserUpsellDialog.react"),{desktopAppstoreLink:d,hideDialog:b("MessengerDialogs.re").removeAllDialogs,isIncoming:!0,onUnmount:function(a){a||b("MessengerDialogs.re").removeAllDialogs()}})});else{a=b("XBrowserNotSupportedDialogController").getURIBuilder().setInt("user_id",c).getURI();this._presentDialog(a)}},showForIncomingGroupCall:function(a,c,d,e){b("FBRTCSoundController").playIncomingRingtone(a,e,{loop:!1,isP2P:!1,isUnsupportedDialog:!0});a=b("XBrowserNotSupportedDialogController").getURIBuilder().setBool("is_group_call",!0).setInt("user_id",d).setStringVector("participants",c).getURI();this._presentDialog(a)},showForOutgoingGroupCall:function(){var a=b("XBrowserNotSupportedDialogController").getURIBuilder().setBool("is_group_call",!0).getURI();this._presentDialog(a)},showForUnsupportedCollabCall:function(){var a=b("XBrowserNotSupportedDialogController").getURIBuilder().setEnum("call_type",g.COLLAB_VIDEO_CALL).getURI();this._presentDialog(a)},showForUnsupportedCollabScreenSharing:function(){var a=b("XBrowserNotSupportedDialogController").getURIBuilder().setEnum("call_type",g.COLLAB_SCREEN_SHARE_CALL).getURI();this._presentDialog(a)},dismiss:function(){this._dialog&&this._dialog.hide()},_presentDialog:function(a,c){var d=this;if(this._dialog)return;a=new(b("AsyncRequest"))(a);b("AsyncDialog").send(a,function(a){d._dialog=a,a.subscribe("hide",function(){d._dialog=null,c&&c()})})}};e.exports=a}),null);
__d("ZenonIncomingCallController",["CurrentUser","FBRTCConstants","MessengerBrowserAlerts","ZenonPreCallHookBuilderHelper","ZenonUserActionLogger"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(a,c,d,e){var f=this;this.$8=function(){f.$9(),b("ZenonPreCallHookBuilderHelper").acceptCall(f.$2,"blue_incoming_dialog_accept_button"),b("ZenonUserActionLogger").logClick({component:"accept_button",surface:"incoming_call_dialog"})};this.$1=null;this.$2=a;this.$3=c;this.$4=null;this.$6=d;this.$5=e}var c=a.prototype;c.onMessageReceived=function(a){var c=this;if(a===null)return;switch(a.type){case"ringing":this.$7(a);var d=new this.$3(a.inviterID,a.controllerParams.callID);d.addListener("answerCall",this.$8);d.addListener("ignoreCall",function(){c.$9(),c.$2.callInviteModel.decline()});d.addListener("timeout",function(){c.$2.callInviteModel.decline("NoAnswerTimeout"),c.$10(a)});this.$5.hideDialog();this.$6.dismiss();d.showIncomingDialog(a.requestingVideo?b("FBRTCConstants").IncomingCallDialogTypes.VIDEO:b("FBRTCConstants").IncomingCallDialogTypes.AUDIO);this.$4=d;b("ZenonUserActionLogger").logImpression({surface:"incoming_call_dialog"});break;case"missed":this.$10(a);break;case"unsupported_browser":this.$9(),this.$4!=null&&this.$4.cancel(),this.$5.hideDialog(),this.$6.showForIncomingCall(Number(a.controllerParams.callID),a.inviterID)}};c.$7=function(a){var c=this;a={callID:a.controllerParams.callID,peerID:a.inviterID,onNotificationClicked:function(){c.$4!=null&&c.$4.cancel(),b("ZenonPreCallHookBuilderHelper").acceptCall(c.$2,"desktop_notification")},isVideoCall:a.requestingVideo,isGroupCall:!0};b("MessengerBrowserAlerts").showRTCNotification(a,function(a){c.$1=a})};c.$9=function(){this.$1&&(this.$1.close(),this.$1=null)};c.$10=function(a){var c=this;this.$9();this.$4!=null&&this.$4.cancel();this.$6.dismiss();this.$5.onCallMissed(a.inviterID);this.$5.showDialog(function(){b("ZenonPreCallHookBuilderHelper").startCall(c.$2,{existingCall:null,invitees:[a.inviterID].concat(a.participants.filter(function(a){return a!==b("CurrentUser").getAccountID()})),mediaType:a.requestingVideo?"video":"audio",thread:a.thread,trigger:"blue_missed_call_dialog"}),b("ZenonUserActionLogger").logClick({component:"call_back",surface:"missed_call_dialog"})});b("ZenonUserActionLogger").logImpression({surface:"missed_call_dialog"})};return a}();e.exports=a}),null);